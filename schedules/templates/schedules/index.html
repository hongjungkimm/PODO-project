{% extends 'base.html' %}
{% load static %}

{% block style %}
<link href="{% static 'css/style.css' %}" rel="stylesheet" type="text/css" />
{% endblock style %}

{% block content %}
  <div>
    <h1>승승장고 포도 프로젝트 일정</h1>
  </div>
  <hr>
  <div style="text-align: right; padding-right: 10px;">
    <button id="createBtn" type="button" class="btn btn-link" data-toggle="modal" data-target="#createModal">
      + 일정 추가하기
    </button>
  </div>
  <!-- Modal -->
  <div class="modal fade" id="createModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title br" style="font-weight: bold;">일정 추가</h5>
          <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form class="schedules_create_modal_form container" action="{% url 'schedules:create_schedule' workspace_pk %}" method="POST">
            {% csrf_token %}
            {{ form }}
            <div class="schedule-title-label">일정 이름</div>
            <div class="schedule-content-label">일정 내용</div>
            <div class="schedule-priority-label">우선순위</div>
            <div class="schedule-start_date-label">시작 날짜</div>
            <div class="schedule-end_date-label">종료 날짜</div>
            <div class="schedule-start_time-label">시작 시간</div>
            <div class="schedule-end_time-label">종료 시간</div>
            <button class="btn schedules_create_modal_btn" type="submit" style="background-color: rgb(145, 92, 172); color: white;"> 확인 </button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class='container schedules_container_main'>
    <br>
    <div class="schedules_left-aside">
      <a class="schedules_left-arrow left" href="{% url 'schedules:index' workspace_pk %}?{{ prev_month_url }}">
      <svg width="35" height="81" viewBox="0 0 35 81" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M1.05799 43.3962C-0.174289 41.662 -0.174289 39.338 1.05799 37.6038L25.9242 2.60979C28.7454 -1.3604 35 0.635513 35 5.50598L35 75.494C35 80.3645 28.7454 82.3604 25.9242 78.3902L1.05799 43.3962Z" fill="#E3E4E6"/>
      </svg>
      </a>
    </div>
    <div class="schedules_right-aside">
      <a class="schedules_right-arrow right" href="{% url 'schedules:index' workspace_pk %}?{{ next_month_url }}">
        <svg width="35" height="81" viewBox="0 0 35 81" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M33.942 37.6038C35.1743 39.338 35.1743 41.662 33.942 43.3962L9.07579 78.3902C6.25463 82.3604 0 80.3645 0 75.494L0 5.50599C0 0.635521 6.25463 -1.36041 9.07579 2.60979L33.942 37.6038Z" fill="#E3E4E6"/>
        </svg>
      </a>
    </div>
    <div class="schedules_header">
      <b style="font-size: 20px">{{ year }}년</b>
      <b style="font-size: 30px">{{ month }}월</b>
    </div>
    <div class="schedules_main">
      {{ calender }}
    </div>
  </div>
   <!-- Modal -->
  <div class="modal fade" id="updateModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title br" style="font-weight: bold;">일정 수정</h5>
          <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="schedules_modal_update_form modal-body container">
          <form id="schedules_updateForm" action="" method="POST">
            {% csrf_token %}
            {{ form.as_p }}
            <div class="schedule-title-label-p">일정 이름</div>
            <div class="schedule-content-label-p">일정 내용</div>
            <div class="schedule-priority-label-p">우선순위</div>
            <div class="schedule-start_date-label-p">시작 날짜</div>
            <div class="schedule-end_date-label-p">종료 날짜</div>
            <div class="schedule-start_time-label-p">시작 시간</div>
            <div class="schedule-end_time-label-p">종료 시간</div>
            <button class="btn schedules_update_modal_Btn1" type="submit" style="background-color: rgb(145, 92, 172); color: white;">수정</button>
          </form>
          <form id="schedules_deleteForm" action="" method='POST'>
            {% csrf_token %}
            <button class='btn schedules_update_modal_Btn2' type='submit' style="background-color: rgb(145, 92, 172); color: white;">삭제</button>
          </from>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}

{% block script %}
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    $('#updateModal').on('show.bs.modal', function (event) {
      var button = event.relatedTarget
      const schedule_pk = button.dataset.scheduleId
      const workspace_pk = button.dataset.workspaceId
      const schedule_title = button.dataset.scheduleTitle
      const schedule_content= button.dataset.scheduleContent
      const schedule_priority = button.dataset.schedulePriority
      const schedule_start_date = button.dataset.scheduleStartDate
      const schedule_end_date = button.dataset.scheduleEndDate
      const schedule_start_time = button.dataset.scheduleStartTime
      const schedule_end_time = button.dataset.scheduleEndTime

      const radioId = `id_priority_${schedule_priority - 1}`
      document.querySelector(`#updateModal #${radioId}`).checked=true

      var modal = $(this)
      modal.find('.my-schedule-title').val(schedule_title)
      modal.find('.my-schedule-content').val(schedule_content)
      modal.find('.my-schedule-start_date').val(schedule_start_date)
      modal.find('.my-schedule-end_date').val(schedule_end_date)
      modal.find('.my-schedule-start_time').val(schedule_start_time)
      modal.find('.my-schedule-end_time').val(schedule_end_time)

      const updateForm = document.querySelector('#schedules_updateForm')
      updateForm.action = `/schedules/workspace/${workspace_pk}/schedule/${schedule_pk}/update/`
      console.log(updateForm)

      const deleteForm = document.querySelector('#schedules_deleteForm')
      deleteForm.action = `/schedules/workspace/${workspace_pk}/schedule/${schedule_pk}/delete/`
      console.log(deleteForm)


      const updatemodalP = document.querySelectorAll('#updateModal p')
      const priorityp = document.querySelector('#updateModal ul')


      updatemodalP[0].setAttribute('class','schedule-title-p')
      updatemodalP[1].setAttribute('class','schedule-content-p')
      updatemodalP[4].setAttribute('class','schedule-start_date-p')
      updatemodalP[5].setAttribute('class','schedule-end_date-p')
      updatemodalP[6].setAttribute('class','schedule-start_time-p')
      updatemodalP[7].setAttribute('class','schedule-end_time-p')
      priorityp.setAttribute('class','schedule-priority-p')

    })
  </script>
{% endblock script %}
</body>
</html>